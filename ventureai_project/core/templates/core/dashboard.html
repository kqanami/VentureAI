
{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="mb-4">
    <h4>Ваши Токены: {{ user.tokens }}</h4>
    <a href="{% url 'core:buy_tokens' %}" class="btn btn-warning">Купить Токены</a>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Ваши Проекты</h2>
    <a href="{% url 'core:project_create' %}" class="btn btn-success">Создать Проект</a>
</div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Название</th>
            <th>Описание</th>
            <th>Бюджет</th>
            <th>Локация</th>
            <th>Конкуренция</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.name }}</td>
            <td>{{ project.description }}</td>
            <td>{{ project.budget }}</td>
            <td>{{ project.location }}</td>
            <td>{{ project.competition_level }}</td>
            <td>
                <a href="{% url 'core:project_update' pk=project.pk %}" class="btn btn-primary btn-sm">Редактировать</a>
                <a href="{% url 'core:project_delete' pk=project.pk %}" class="btn btn-danger btn-sm">Удалить</a>
                <a href="{% url 'core:project_analyze' pk=project.pk %}" class="btn btn-warning btn-sm">Анализировать</a>
            </td>
        </tr>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="{% url 'core:dashboard' %}">VentureAI</a>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
                <li class="nav-item"><a class="nav-link" href="{% url 'core:business_advice' %}">Бизнес-консультант</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'core:similar_businesses' %}">Похожие бизнесы</a></li>
            {% endif %}
        </ul>
    </div>
</nav>

    <td colspan="6">
        <strong>История анализов:</strong>
        {% if project.analyses.all %}
            <ul>
                {% for analysis in project.analyses.all %}
                    <li>
                        {{ analysis.analyzed_at|date:"d.m.Y H:i" }} — Вероятность успеха: {{ analysis.success_probability }}%<br>
                        Рекомендации: {{ analysis.recommendations }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            Нет проведённых анализов.
        {% endif %}
    </td>
</tr>
<tr>
    <td colspan="6">
        <strong>Оставить комментарий:</strong>
        <form action="{% url 'core:add_comment' pk=project.pk %}" method="post">
            {% csrf_token %}
            <div class="mb-2">
                <textarea name="comment" class="form-control" rows="2" placeholder="Ваш комментарий"></textarea>
            </div>
            <div class="mb-2">
                <label for="rating_{{ project.pk }}">Оценка (0-5): </label>
                <input type="number" id="rating_{{ project.pk }}" name="rating" min="0" max="5" class="form-control" style="width: 80px; display: inline-block;">
            </div>
            <button type="submit" class="btn btn-sm btn-primary">Отправить</button>
        </form>
        <hr>
        <strong>Комментарии:</strong>
        {% if project.comments.all %}
            <ul>
                {% for comment in project.comments.all %}
                    <li>
                        <strong>{{ comment.user.username }}:</strong> {{ comment.comment }}<br>
                        Оценка: {{ comment.rating }} | {{ comment.created_at|date:"d.m.Y H:i" }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            Нет комментариев.
        {% endif %}
    </td>
</tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
